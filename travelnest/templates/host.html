{% extends 'base.html' %}
{% load static %}

{% block content %}
<style>
  /* Custom CSS for Host Dashboard Page */
  ul {
  padding: 0;
  margin: 0;
  list-style: none;
}

.list {
  background-color: #ecf0f1;
  border: 1px solid #dfe6e9;
  border-radius: 5px;
  padding: 10px;
  margin-bottom: 10px;
  display: flex;
  justify-content: space-between;
}

/* Style for status label */
.status-label {
  font-weight: bold;
  color: #3498db;
}

/* Apply different background colors based on status */
li[data-status="approved"] {
  background-color: #2ecc71;
  color: #fff;
}

li[data-status="pending"] {
  background-color: #f39c12;
  color: #fff;
}

li[data-status="unapproved"] {
  background-color: #e74c3c;
  color: #fff;
}
/* Main Content Area */
.main-content {
  margin-top: 20px;
}

/* Welcome Message */
.welcome-message {
  color: #3498db;
}

/* Add Homestay Heading */
.add-homestay-heading {
  margin-top: 20px;
  color: #2ecc71;
}

/* Sidebar Styles */
.sidebar {
  background-color: #ecf0f1;
  padding: 15px;
  border-radius: 5px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.sidebar h3 {
  color: #3498db;
}

/* Sidebar List Styles */
.sidebar ul {
  list-style-type: none;
  padding: 0;
}

.sidebar li {
  margin-bottom: 10px;
}

/* Sidebar Link Styles */
.sidebar a {
  text-decoration: none;
  color: #2c3e50;
}

.sidebar a:hover {
  color: #3498db;
}

</style>
  <div class="container main-content">
    <div class="row">
      <!-- Main Content Area -->
      <div class="col-md-9">
        <h2>Welcome, {{ user.username }}!</h2>
        <h3>Your Homestays</h3>

        <!-- Filter dropdown with automatic form submission -->
        <form method="get" action="{% url 'host_dashboard' %}" id="filterForm">
          <label for="status">Filter by Status:</label>
          <select name="status" id="status" onchange="document.getElementById('filterForm').submit()">
            <option value="approved" {% if status == 'approved' %}selected{% endif %}>Approved</option>
            <option value="pending" {% if status == 'pending' %}selected{% endif %}>Pending</option>
            <option value="unapproved" {% if status == 'unapproved' %}selected{% endif %}>Unapproved</option>
          </select>
          <!-- Use a button to submit the form, you can style it as needed -->
          <button type="submit" style="display: none;"></button>
        </form>

        <!-- Display homestays -->
        {% if homestays %}
          <ul>
            {% for homestay in homestays %}
              <li class="list">{{ homestay.name }} - {{ homestay.location }} - {{ homestay.status }}</li>
              <!-- Add other details you want to display -->
            {% endfor %}
          </ul>
        {% else %}
          <p>No homestays found.</p>
        {% endif %}
      </div>

      <!-- Sidebar -->
      <div class="col-md-3">
        <!-- Your existing sidebar content -->
        <div class="sidebar">
          <h3>Host Dashboard</h3>
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link" href="{% url 'add' %}">Add</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{% url 'host_dashboard' %}">Homestays</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{% url 'bookings' %}">Bookings</a>
            </li>

          </ul>

        </div>
        <button type="submit" id="payment-button" class="btn btn-primary mt-3">Pay to Admin</button>

      </div>
      
    </div>
  </div>

  <script src="https://khalti.s3.ap-south-1.amazonaws.com/KPG/dist/2020.12.17.0.0.0/khalti-checkout.iffe.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

  <script>
    // JavaScript to submit the form when dropdown value changes
    document.getElementById('status').addEventListener('change', function() {
      document.getElementById('filterForm').submit();
    });
      function verifyPayment(payload) {
        $.ajax({
            url: "{% url 'verifypayment' %}",
            type: "POST",
            data: payload,
            dataType: 'json',
            success: function (response) {
                if (response.status === 'success') {
                    alert(response.message);
                } else {
                    alert(response.message);
                }
            },
            error: function (error) {
                alert('Error verifying payment.');
                console.log(error);
            }
        });
    }

      var config = {
            "publicKey": "test_public_key_d486e3b6505743d4896f0f5f59ef50f1",
            "productIdentity": "1",
            "productName": "travelnest",
            "productUrl": "http://127.0.0.1:8000/",
            "paymentPreference": [
                "KHALTI",
                "EBANKING",
                "MOBILE_BANKING",
                "CONNECT_IPS",
                "SCT",
                ],
            "eventHandler": {
              onSuccess: function (payload) {
                        verifyPayment(payload);
                    },
                    onError: function (error) {
                        console.log(error);
                    },
                    onClose: function () {
                        console.log('widget is closing');
                    }
                }
            };
        var checkout = new KhaltiCheckout(config);
        var btn = document.getElementById("payment-button");
        btn.onclick = function () {
            // minimum transaction amount must be 10, i.e 1000 in paisa.
            checkout.show({amount: 2000});
        };
  </script>

{% endblock %}
