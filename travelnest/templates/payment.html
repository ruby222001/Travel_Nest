{% extends 'base.html' %}
{% load static %}
{% block extrastyle %}
    <link href="{% static 'css/style1.css' %}" rel="stylesheet" />
    <style>
        /* Styles for the pop-up container */
        .popup-container {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px;
            background-color: #fff;
            border: 1px solid #ccc;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            text-align: center;
        }

        /* Styles for the overlay background */
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 900;
        }
        .payment-button {
        height: 10px;
        width: 10px;
    }
    </style>
{% endblock %}
{% block content %}
    <br>
    <h1 class="booking-center-text">Booking Details</h1>
    <div class="progress-box">
        <div class="step booking-step {% if step == 1 %}active{% endif %}">
            <div class="step-circle booking-step-circle {% if step == 1 %}booking-active-step-circle{% endif %}">1</div>
        </div>
        <div class="line"></div>
        <div class="step booking-step {% if step == 2 %}active{% endif %}">
            <div class="step-circle booking-step-circle {% if step == 2 %}booking-active-step-circle{% endif %}">2</div>
        </div>
        <div class="line"></div>
        <div class="step booking-step {% if step == 3 %}active{% endif %}">
            <div class="step-circle booking-step-circle {% if step == 3 %}booking-active-step-circle{% endif %}">3</div>
        </div>
        <div class="progress-bar blue-progress-bar" id="progress"></div>
    </div>

    <div class="reservation-info-box">
        <h2 style="text-align: center;">Payment</h2>
        <br>
        <form id="paymentForm" action="{% url 'payment' %}" method="post">
            {% csrf_token %}

            <div>
                <label for="fullname">User name</label>
                <input type="text" id="fullname" class="form1" name="fullInput">
            </div>
            <div >
                <label for="email">Email:</label>
                <input type="text" name="email" class="form1" id="email">
            </div>
            <div class="form-group">
                
                <div class="form-field">
                    <label for="number">Nationality</label>
                    <input type="country" name="text" class="form1" id="number">
                </div>
                <div class="form-field">
                    <label for="number">Phone Number:</label>
                    <input type="text" name="number" class="form1" id="number">
                </div>
              
            </div><br>
            <div style="text-align: center;">
                <button onclick="showPopup();" type="button">Proceed</button>
            </div>
        </form>

        <div class="popup-container" id="popup">
            <h2>Choose payment option</h2>
            <br>
            <br>
            <a href="#"id="payment-button" style="height: 30px; width: 30px;" onclick="handlePaymentOption('Khalti');hidePopup();">
                <img src="{% static 'images/khaltilogo.png' %}" alt="Logo 1">
            </a>
            <script>
                function verifyPayment(payload) {
        $.ajax({
            url: "{% url 'verify_payment' %}",
            type: "POST",
            data: payload,
            dataType: 'json',
            success: function (response) {
    if (response.status === 'true') {
        alert(response.message);
        // Handle success case here
    } else {
        alert(response.message);
        // Handle failure case here
    }
},        });
    }

                document.addEventListener("DOMContentLoaded", function () {
             
                    var config = {
                        "publicKey": "test_public_key_f359d2bd4ccc4bc2ad77916a0eba7199",
                        "productIdentity": "1234567890",
                        "productName": "TravelNest",
                        "productUrl": "http://127.0.0.1:8000/",
                        "paymentPreference": [
                            "KHALTI",
                           
                        ],
                        "eventHandler": {
                            onSuccess: function (payload) {
                                console.log(payload);
                verifyPayment(payload);
                
            },
                                    
                            
                            onError: function (error) {
                                console.log(error);
                            },
                            onClose: function () {
                                console.log('widget is closing');
                            }
                        }
                    };
        
                    var checkout = new KhaltiCheckout(config);
                    var btn = document.getElementById("payment-button");
                    btn.onclick = function () {
                        checkout.show({ amount: 1000 });
                    };
                });
            </script>
           
           <a href="#" onclick="showPayOnArrivalPopup();hidePopup();">Pay on Arrival</a>
        </div>
        
        <div class="popup-container" id="payOnArrivalPopup">
            <h2 style="font-weight: bold;">
                Pay on Arrival</h2><br><br>
            <p style="font-size:160%;">Thank you for Booking. You can make the payment when you arrive.
            
            </p>
            <br>
            <button  onclick="hidePayOnArrivalPopup()">CLose</button>
        </div>
        <script>
            function showPopup() {
                document.getElementById('popup').style.display = 'block';
            }

            function hidePopup() {
                document.getElementById('popup').style.display = 'none';
                document.getElementById('overlay').style.display = 'none';
            }
            function showPayOnArrivalPopup() {
        document.getElementById('payOnArrivalPopup').style.display = 'block';
    }

    function hidePayOnArrivalPopup() {
        document.getElementById('payOnArrivalPopup').style.display = 'none';
        document.getElementById('overlay').style.display = 'none';
    }
    function handlePaymentOption(option) {
        // Close the main popup
        hidePopup();

        // Show the relevant payment method popup
        if (option === 'Khalti') {
            // Additional actions for Khalti option
            // ...
        } else if (option === 'PayOnArrival') {
            showPayOnArrivalPopup();
        }
    }
        </script>
        
    </div>
{% endblock %}
